
TODO:
=====

- 

- schema version, needs tob e present in the Makefile (for installation of
  schemas) and in the code (to check). Figure out a good way to handle this.

{
  - verify checksum of /repodata/repomd.xml

  - Do we need to provide a keyring and accept new keys? 
    Talk to security-team about this.

  Talked to security-team: This is nice to have but no requirement
  because the client are checking the repomd too.
}


- SMT Add-On Product (server)
  * someone needs to build and sign the add-on periodically
  * add-on contains all server RPMs
  * new packages (e.g.) skelcd-control-SMT and skelcd-SMT
    (internal ones, for building the add-on)
  * ... (maybe to be discussed with POS team)
  * IMPORTANT: This add-on product must call the registration
               module if it is installed later on an existing SLES10
               using the yast2 add-on module

- yast module:
  - Write parameter in smt.conf (what does this mean?)
    [LOCAL]
    url=...
    https://<local.full.quallified.domain.name>/ 
    nccEmail=<emailaddress>


- test what happens if two processes want to write smt.db
  How can we solve concurent access with DBI?

- create, implement and test a strategy how we can update the database structure
  after release. (e.g. if we need to add some tables, or collumns in tables) 

- look on how to implement the migration using the module (dmacvicar)

- modify listProducts registration command for SMT.
  Show only products where all required catalogs are localy mirrored.
  Is this a good idea?

- yast module:
  maybe set max_connections=160 in /etc/my.cnf
  needs some disuccion.

- create symlinks for activating smt
  locilka proposed to create init.d script for smt. It would require apache2 and 
  mysql services. This could also cover database update.

- yast module: reset/set mysql root password, create yep user, set yep 
  configuration file and make sure only www-run can read it (part of the init 
  script?)
  (default permissions of smt.conf are now 640, wwwrun, root)

- fix generating repoindex (jdsn)
  (use TARGET in Clients Table)

- provide details how to change the NU password for mysql, creating SMT 
  database, creating user and granting permissions, store the credentials in 
  smt.conf file (duncan)

- cron jobs for other smt tasks (locilka)
  * smt-ncc-sync, smt-mirror and smt-report maybe together in one job (one time a day)
  * smt-register in an extra job (every quarter?)

  Check if we can provide a default with the yep rpm.
  What happens if they are %config(noreplace)?
  Will a .rpmsave or .rpmnew file be a new cronjob?

- enhance the lock functions. If a lockfile is present, check if the process
  is realy running. If not remove the lockfile and go on.

 

DONE:
=====

- localization of the client tools

- support HTTPS - the suse_register will only connect via https

- yast module
  * credentials and their testing
  * adjusting /etc/sysconfig/apache2
  * reloading apache2 when configuration changed
  * insserving apache2 if needed
  * configures cron to run /usr/bin/smt-mirror.pl periodically
  * insserving cron if needed
  * restarting cron if needed
  * checks and installs cron package if needed, otherwise
    are cron-relaetd functions disabled
  * check if a common server certificate is available
    exists /etc/ssl/servercerts/servercert.pem
    if it doesn't, offers to call a service proposal (CA proposal)
  * copies the CA (or the server certificate) to
    /srv/www/htdocs/smt.crt

- yast module:
  * found out that the server certificate does not work.
    we need to copy the ca-certificate to /srv/www/htdocs/smt.crt
    The ca can be found at:
    /etc/ssl/certs/YaST-CA.pem

- SMT::Registration listparam has to check for "accept=''" option
  [Not needed, a stripped result is produced by the client (suse_register)
   only]

- smt.db must be owned by user "wwwrun"
  Found out that sqlite must have write access to the directory too.
  We should think about to move the DB to /var/lib/wwwrun/
  [Is now at /var/lib/SMT/db/]

- call verify (smt-mirror.pl) after syncing a repo and restart syncing 
  if verify failed (e.g. 3 times before stopping)

- smt-mirror.pl: After mirror check if there are catalogs where the
  DOMIRROR flag is set to "Y" but the MIRRORABLE flag is set to "N".
  This can happen if an entitlement is expired on NCC. 
  In such a case we should print a warning message to inform the
  administrator that a catalog cannot be mirrored. He should check
  in NCC if he has an entitlement for this product.

- tool to setup custom catalogs?

- client tool for setting/initializing the "Mirrorable" flag
  in the Catalogs table:
       Comment: initialize database itself 
  * update Catalogs SET Mirrorable='N'
       Comment: set Mirrorable='N' everywhere (part of basic initialization)
  * download repo/repoindex.xml, parse it and set the
    available catalogs to 'Y' again.
       Comment: download "repo/repoindex.xml" and for all available catalogs in there
                set the Mirrorable flag to 'Y'
  * try to access repomd.xml of all zypp catalogs and set
    the "Mirroable" flags to 'Y' again
       Comment: download "repomd.xml" and for all available catalogs in there
                set the Mirrorable flag to 'Y'
       All three jobs should be run by:  smt initialize

- client tool to view all mirrorable catalogs and change the
  "DoMirror" Flag on demand.
      Comment: should support "list all catalogs" for Mirrorable and All catalog
                   smt list catalogs      (list Mirrorable)
                   smt list -a catalogs   (list all)
                   smt list products      (here we need the products list)
               List required fields (at least id, name, version, arch) to easyly activate them like this:
                   smt activate <catalog_id>
                   smt activate <catalog_name>
                   smt activate --product <product_name>    (resolves internally what catalogs this product has)
                   smt activate --version <verision_name>   (does this make sense?)
                   smt activate --arch <arch_name>          (does this make sense?)
               Only Mirroable catalogs can be activated!



- client tool to view :
  * the registrations
  * used products

- write yast module for initial setup
  * start database initialization (ncc-mirror) at the end
    of the YaST run.
  * NiceToHave: configuration of a cronjob for smt-mirror.pl

- add a logfile option to smt-mirror.pl and prepare the SMT::Mirror::... 
  modules to print in a logfile

- provide test and production enviroment. 
  A restricted area to test patches and if tests are ok move them
  to production so that they can used by everyone.
  * register the testing enviroment can be done by providing a special
    URL parameter. Such a parameter can be configured on the clients in
    /etc/suseRegister.conf 

- have a look at the mod_perl Database handle feature.
  one db handle for apache
  perl-Apache-DBI
  Have a look at doc/Server-Tuning.txt

- how can a customer say, that he always wants to mirror _all_ mirrorable catalogs?
  Idea: add an "mirrorall" option to smt.conf and modify smt-ncc-sync to set 
        DOMIRROR flag to 'Y' for all mirrorable catalogs if this option is true 

- yup has a hardlink feature. Would be nice if we could have it too.
  It searches for same files (SLES <=> SLED as example) and
  create a hardlink to safe some disk space.

- add a parameter to smt.conf  about disable client registration at NCC
  * use this parameter in smt-register and smt-delete-registration




